<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Log to an in-memory data.table — AppenderDt • lgrExtra</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Log to an in-memory data.table — AppenderDt" />
<meta property="og:description" content="An Appender that outputs to an in-memory data.table. It fulfill a similar
purpose as the more flexible AppenderBuffer and is mainly included for
historical reasons/backwards compatibility with older version of lgr." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lgrExtra</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.9010</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/lgrExtra.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Log to an in-memory data.table</h1>
    
    <div class="hidden name"><code>AppenderDt.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>An Appender that outputs to an in-memory <code>data.table</code>. It fulfill a similar
purpose as the more flexible AppenderBuffer and is mainly included for
historical reasons/backwards compatibility with older version of <strong>lgr</strong>.</p>
    </div>



    <h2 class="hasAnchor" id="custom-fields"><a class="anchor" href="#custom-fields"></a>Custom Fields</h2>

    


<p><code>AppenderDt</code> supports custom fields, but they have to be
pre-allocated in the <code>prototype</code> argument. Custom fields that are not
part of the prototype are inserted in the list-column <code>.fields</code> if it
exists.</p>
    <h2 class="hasAnchor" id="creating-a-data-table-appender"><a class="anchor" href="#creating-a-data-table-appender"></a>Creating a Data Table Appender</h2>

    


<p>In addition to the usual fields, <code>AppenderDt$new()</code> requires that you supply
a <code>buffer_size</code> and a <code>prototype</code>. These determine the structure of the
<code>data.table</code> used to store the log this appender creates and cannot be
modified anymore after the instantiation of the appender.</p>
<p>The <a href='https://s-fleck.github.io/lgr/reference/Layout.html'>lgr::Layout</a> for this Appender is used only to format console output of
its <code>$show()</code> method.</p>
    <h2 class="hasAnchor" id="comparison-appenderbuffer-and-appenderdt"><a class="anchor" href="#comparison-appenderbuffer-and-appenderdt"></a>Comparison AppenderBuffer and AppenderDt</h2>

    


<p>Both AppenderBuffer and AppenderDt do in memory buffering of events.
AppenderBuffer retains a copies of the events it processes and has the
ability to pass the buffered events on to other Appenders. AppenderDt
converts the events to rows in a <code>data.table</code> and is a bit harder to
configure. Used inside loops (several hundred iterations),
AppenderDt has much less overhead than AppenderBuffer. For single logging
calls and small loops, AppenderBuffer is more performant. This is related to
how memory pre-allocation is handled by the appenders.</p>
<p>In short: Use AppenderDt if you want an in-memory log for interactive use,
and AppenderBuffer if you actually want to buffer events</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>LayoutFormat, simple_logging, <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table::data.table</a></p></div>
    <h2 class="hasAnchor" id="super-classes"><a class="anchor" href="#super-classes"></a>Super classes</h2>

    <p><code><a href='https://s-fleck.github.io/lgr/reference/Filterable.html'>lgr::Filterable</a></code> -&gt; <code><a href='https://s-fleck.github.io/lgr/reference/Appender.html'>lgr::Appender</a></code> -&gt; <code>AppenderDt</code></p>
    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    
<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Public methods</h3>

<ul>
<li><p><a href='#method-new'><code>AppenderDt$new()</code></a></p></li>
<li><p><a href='#method-append'><code>AppenderDt$append()</code></a></p></li>
<li><p><a href='#method-show'><code>AppenderDt$show()</code></a></p></li>
<li><p><a href='#method-set_layout'><code>AppenderDt$set_layout()</code></a></p></li>
</ul>
<p><details ><summary>Inherited methods</summary>
<ul>
<li><p><span class="pkg-link" data-pkg="lgr" data-topic="Filterable" data-id="add_filter"><a href='../../lgr/html/Filterable.html#method-add_filter'><code>lgr::Filterable$add_filter()</code></a></span></p></li>
<li><p><span class="pkg-link" data-pkg="lgr" data-topic="Filterable" data-id="filter"><a href='../../lgr/html/Filterable.html#method-filter'><code>lgr::Filterable$filter()</code></a></span></p></li>
<li><p><span class="pkg-link" data-pkg="lgr" data-topic="Filterable" data-id="remove_filter"><a href='../../lgr/html/Filterable.html#method-remove_filter'><code>lgr::Filterable$remove_filter()</code></a></span></p></li>
<li><p><span class="pkg-link" data-pkg="lgr" data-topic="Filterable" data-id="set_filters"><a href='../../lgr/html/Filterable.html#method-set_filters'><code>lgr::Filterable$set_filters()</code></a></span></p></li>
<li><p><span class="pkg-link" data-pkg="lgr" data-topic="Appender" data-id="format"><a href='../../lgr/html/Appender.html#method-format'><code>lgr::Appender$format()</code></a></span></p></li>
<li><p><span class="pkg-link" data-pkg="lgr" data-topic="Appender" data-id="set_threshold"><a href='../../lgr/html/Appender.html#method-set_threshold'><code>lgr::Appender$set_threshold()</code></a></span></p></li>
</ul>
</details>

<hr>
<a id="method-new"></a></p><h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Method <code>new()</code></h3>
<p>Creating a new AppenderDt</p><h4 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Usage</h4>
<p><div class="r"></p><pre><span class='va'>AppenderDt</span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span>
  threshold <span class='op'>=</span> <span class='cn'>NA_integer_</span>,
  layout <span class='op'>=</span> <span class='va'>LayoutFormat</span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span>fmt <span class='op'>=</span> <span class='st'>"%L [%t] %m %f"</span>, timestamp_fmt <span class='op'>=</span> <span class='st'>"%H:%M:%OS3"</span>,
    colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"lgr.colors"</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,
  prototype <span class='op'>=</span> <span class='fu'>data.table</span><span class='fu'>::</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span>.id <span class='op'>=</span> <span class='cn'>NA_integer_</span>, level <span class='op'>=</span> <span class='cn'>NA_integer_</span>, timestamp
    <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span>, logger <span class='op'>=</span> <span class='cn'>NA_character_</span>, caller <span class='op'>=</span> <span class='cn'>NA_character_</span>, msg <span class='op'>=</span> <span class='cn'>NA_character_</span>,
    .fields <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,
  buffer_size <span class='op'>=</span> <span class='fl'>1e+05</span>,
  filters <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre><p></div></p>

<h4 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Arguments</h4>
<p><div class="arguments"></p><dl>
<dt><code>prototype</code></dt><dd><p>A prototype <code>data.table</code>. The prototype must be a
<code>data.table</code> with the same columns and column types as the data
you want to log. The actual content of the columns is irrelevant.
There are a few reserved column names that have special meaning:
* <code>.id</code>: <code>integer</code> (mandatory). Must always be the first column
and is used internally by the Appender
* <code>.fields</code>: <code>list</code> (optional). If present all custom values of the
event (that are not already part of the prototype) are stored in
this list column.</p></dd>

<dt><code>buffer_size</code></dt><dd><p><code>integer</code> scalar. Number of rows of the in-memory <code>data.table</code></p></dd>

</dl><p></div></p>
<p><hr>
<a id="method-append"></a></p><h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Method <code><a href='https://rdrr.io/r/base/append.html'>append()</a></code></h3>

<h4 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Usage</h4>
<p><div class="r"></p><pre><span class='va'>AppenderDt</span><span class='op'>$</span><span class='fu'>append</span><span class='op'>(</span><span class='va'>event</span><span class='op'>)</span></pre><p></div></p>

<p><hr>
<a id="method-show"></a></p><h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Method <code>show()</code></h3>

<h4 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Usage</h4>
<p><div class="r"></p><pre><span class='va'>AppenderDt</span><span class='op'>$</span><span class='fu'>show</span><span class='op'>(</span>threshold <span class='op'>=</span> <span class='cn'>NA_integer_</span>, n <span class='op'>=</span> <span class='fl'>20L</span><span class='op'>)</span></pre><p></div></p>

<p><hr>
<a id="method-set_layout"></a></p><h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Method <code>set_layout()</code></h3>

<h4 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Usage</h4>
<p><div class="r"></p><pre><span class='va'>AppenderDt</span><span class='op'>$</span><span class='fu'>set_layout</span><span class='op'>(</span><span class='va'>layout</span><span class='op'>)</span></pre><p></div></p>




    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>lg</span> <span class='op'>&lt;-</span> <span class='fu'>lgr</span><span class='fu'>::</span><span class='fu'><a href='https://s-fleck.github.io/lgr/reference/get_logger.html'>get_logger</a></span><span class='op'>(</span><span class='st'>"test"</span><span class='op'>)</span>
<span class='va'>lg</span><span class='op'>$</span><span class='fu'>config</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
  appenders <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>memory <span class='op'>=</span> <span class='va'>AppenderDt</span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>,
  threshold <span class='op'>=</span> <span class='cn'>NA</span>,
  propagate <span class='op'>=</span> <span class='cn'>FALSE</span>  <span class='co'># to prevent routing to root logger for this example</span>
<span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; &lt;Logger&gt; [all] test
#&gt; 
#&gt; appenders:
#&gt;   memory: &lt;AppenderDt&gt; [all] -&gt; in memory data.table</div><div class='input'><span class='va'>lg</span><span class='op'>$</span><span class='fu'>debug</span><span class='op'>(</span><span class='st'>"test"</span><span class='op'>)</span>
<span class='va'>lg</span><span class='op'>$</span><span class='fu'>error</span><span class='op'>(</span><span class='st'>"test"</span><span class='op'>)</span>

<span class='co'># Displaying the log</span>
<span class='va'>lg</span><span class='op'>$</span><span class='va'>appenders</span><span class='op'>$</span><span class='va'>memory</span><span class='op'>$</span><span class='va'>data</span>
</div><div class='output co'>#&gt;   .id level           timestamp logger caller  msg .fields
#&gt; 1   1   500 2020-12-29 20:00:45   test   eval test    NULL
#&gt; 2   2   200 2020-12-29 20:00:45   test   eval test    NULL</div><div class='input'><span class='va'>lg</span><span class='op'>$</span><span class='va'>appenders</span><span class='op'>$</span><span class='va'>memory</span><span class='op'>$</span><span class='fu'>show</span><span class='op'>(</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span style='color: #555555;'>DEBUG</span><span> [20:00:45.466] test 
#&gt; </span><span style='color: #D75F5F;'>ERROR</span><span> [20:00:45.507] test </div><div class='input'><span class='fu'>lgr</span><span class='fu'>::</span><span class='fu'><a href='https://s-fleck.github.io/lgr/reference/simple_logging.html'>show_log</a></span><span class='op'>(</span>target <span class='op'>=</span> <span class='va'>lg</span><span class='op'>$</span><span class='va'>appenders</span><span class='op'>$</span><span class='va'>memory</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='color: #555555;'>DEBUG</span><span> [20:00:45.466] test 
#&gt; </span><span style='color: #D75F5F;'>ERROR</span><span> [20:00:45.507] test </div><div class='input'>
<span class='co'># If you pass a Logger to show_log(), it looks for the first AppenderDt</span>
<span class='co'># that it can find.</span>
<span class='fu'>lgr</span><span class='fu'>::</span><span class='fu'><a href='https://s-fleck.github.io/lgr/reference/simple_logging.html'>show_log</a></span><span class='op'>(</span>target <span class='op'>=</span> <span class='va'>lg</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='color: #555555;'>DEBUG</span><span> [20:00:45.466] test 
#&gt; </span><span style='color: #D75F5F;'>ERROR</span><span> [20:00:45.507] test </div><div class='input'>
<span class='co'># Custom fields are stored in the list column .fields by default</span>
<span class='va'>lg</span><span class='op'>$</span><span class='fu'>info</span><span class='op'>(</span><span class='st'>"the iris data frame"</span>, caps <span class='op'>=</span> <span class='va'>LETTERS</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>lg</span><span class='op'>$</span><span class='va'>appenders</span><span class='op'>$</span><span class='va'>memory</span><span class='op'>$</span><span class='va'>data</span>
</div><div class='output co'>#&gt;   .id level           timestamp logger caller                 msg       .fields
#&gt; 1   1   500 2020-12-29 20:00:45   test   eval                test          NULL
#&gt; 2   2   200 2020-12-29 20:00:45   test   eval                test          NULL
#&gt; 3   3   400 2020-12-29 20:00:45   test   eval the iris data frame A, B, C, D, E</div><div class='input'><span class='va'>lg</span><span class='op'>$</span><span class='va'>appenders</span><span class='op'>$</span><span class='va'>memory</span><span class='op'>$</span><span class='va'>data</span><span class='op'>$</span><span class='va'>.fields</span><span class='op'>[[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='va'>caps</span>
</div><div class='output co'>#&gt; [1] "A" "B" "C" "D" "E"</div><div class='input'><span class='va'>lg</span><span class='op'>$</span><span class='fu'>config</span><span class='op'>(</span><span class='cn'>NULL</span><span class='op'>)</span>
</div><div class='output co'>#&gt; &lt;Logger&gt; [</span><span style='color: #555555;'>info</span><span>] test
#&gt; 
#&gt; inherited appenders:
#&gt;   console: &lt;AppenderConsole&gt; [all] -&gt; console</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Stefan Fleck.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


